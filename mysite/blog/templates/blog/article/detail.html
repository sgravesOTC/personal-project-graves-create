{% extends "blog/base.html" %}
{% load static %}

{% block title %}{{ article.title }}{% endblock %}

{% block content %}
<article class="article-detail">
    {% if article.image %}
    <img src="{{ article.image}}" alt="{{ article.title }}" class="article-detail-image">
    {% endif %}
    
    <header class="article-header">
        <div class="article-meta-line">
            <time class="article-date" datetime="{{ article.publish|date:'c' }}">
                {{ article.publish|date:"F j, Y" }}
            </time>
            <span class="meta-separator">·</span>
            <span class="article-author">By {{ article.author.get_full_name|default:article.author.username }}</span>
        </div>
        
        <h1 class="article-detail-title">{{ article.title }}</h1>
        
        <div class="article-decorative-line"></div>
    </header>

    <div class="article-body">
         {{ article.body|linebreaks }}
        {% for section in article.sections.all %}
        <section class="article-section">
            <h2 class="section-header">{{ section.header }}</h2>
            <div class="section-body">
                {{ section.body|linebreaks }}
            </div>
        </section>
        {% endfor %}
    </div>

    {% if article.references.exists %}
    <section class="references-section">
        <h2 class="references-title">References</h2>
        <ol class="references-list">
            {% for reference in article.references.all %}
            <li class="reference-item">
                <span class="reference-author">{{ reference.author }}.</span>
                <span class="reference-title">{{ reference.title }}.</span>
                {% if reference.publish %}
                <span class="reference-date">({{ reference.publish|date:"Y" }}).</span>
                {% endif %}
                {% if reference.ref_url %}
                {% if reference.ref_url|slice:":4" == "http" %}
                <a href="{{ reference.ref_url }}" class="reference-url" target="_blank" rel="noopener noreferrer">
                    {{ reference.ref_url }}
                </a>
                {% else %}
                <a href="https://{{ reference.ref_url }}" class="reference-url" target="_blank" rel="noopener noreferrer">
                    {{ reference.ref_url }}
                </a>
                {% endif %}
                {% endif %}
            </li>
            {% endfor %}
        </ol>
    </section>
    {% endif %}

    <footer class="article-footer">
        <div class="article-footer-divider"></div>
        <div class="article-footer-content">
            <div class="author-info">
                <div class="author-avatar">
                    {{ article.author.username|slice:":1"|upper }}
                </div>
                <div class="author-details">
                    <p class="author-name">{{ article.author.get_full_name|default:article.author.username }}</p>
                    <p class="author-bio">Writer and contributor</p>
                </div>
            </div>
            
            <a href="{% url 'blog:article_list' %}" class="back-link">
                <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
                    <path d="M12.5 15L7.5 10L12.5 5" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
                <span>Back to articles</span>
            </a>
        </div>
    </footer>
</article>

<aside class="related-articles">
    <h3 class="related-title">Continue Reading</h3>
    <div class="related-links">
        <a href="{% url 'blog:article_list' %}" class="related-link">Browse all articles →</a>
    </div>
</aside>
{% endblock %}